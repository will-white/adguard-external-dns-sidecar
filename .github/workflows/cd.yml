name: CD

on:
  push:
    tags:
      - 'v*'
  workflow_call:
    inputs:
      version:
        description: 'Version tag to build (e.g. v1.0.0)'
        required: false
        type: string
        default: ''
      latest:
        description: 'Tag as latest'
        required: false
        type: boolean
        default: true

# CD uses the shared build workflow with push enabled
# This ensures CI and CD use identical build processes
jobs:
  build-and-push:
    name: Build and Push
    uses: ./.github/workflows/build.yml
    with:
      push: true
      version: ${{ inputs.version || github.ref_name }}
      latest: ${{ inputs.latest }}
    permissions:
      contents: read
      packages: write
